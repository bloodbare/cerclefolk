<metal:widgets define-macro="widgets" i18n:domain="eea" 
    tal:define="mode mode | string:edit;
                view_mode python:mode == 'view';
                edit_mode python:mode == 'edit';
                search_mode python:mode == 'search';

                faceted_query nocall:here/@@faceted_query;
                faceted_html python:faceted_query(ajax=False) if (not view.disable_smart_facets and view_mode) else '';
                visible python:edit_mode or search_mode or view.check_display_criteria(faceted_html);
                positions python:visible and view.positions or [];
                positions python:dict((x.value, x.title) for x in positions);
                
                widgets_left python: len([o for o in view.get_view_widgets(position='left')]) > 0;
                widgets_right python: len([o for o in view.get_view_widgets(position='right')]) > 0;

                faceted_col_esq python:{'col_esq': {'mostrar': True, 'width': 'span3'},
                                        'col_dreta': {'mostrar': False, 'width': ''},
                                        'col_centre': {'mostrar': True, 'width': 'span9'},
                                        'classe': 'faceted_col_esq'};
                
                faceted_col_dreta python:{'col_esq': {'mostrar': False, 'width': ''},
                                          'col_dreta': {'mostrar': True, 'width': 'span3'},
                                          'col_centre': {'mostrar': True, 'width': 'span9'},
                                          'classe': 'faceted_col_dreta'};
                
                faceted_full python:{'col_esq': {'mostrar': True, 'width': 'span3'},
                                     'col_dreta': {'mostrar': True, 'width': 'span3'},
                                     'col_centre': {'mostrar': True, 'width': 'span6'},
                                     'classe': 'faceted_full'};

                faceted_cols python:faceted_full if (edit_mode or (not edit_mode and widgets_left and widgets_right)) else (faceted_col_esq if (widgets_left and not widgets_right) else faceted_col_dreta);">

    <section  tal:attributes="class string:faceted ${faceted_cols/classe}">

        <div class="row-fluid">
            <div class="span12" id="top-area">
                <metal:position use-macro="here/@@faceted_macros/macros/position" />
            </div>
        </div>

        <div class="row-fluid central_columns">
            <div tal:condition="faceted_cols/col_esq/mostrar"
                 tal:attributes="class faceted_cols/col_esq/width" 
                 id="left-column"
                 tal:define="position string:left">
                <metal:position use-macro="here/@@faceted_macros/macros/position" />
            </div>
            <div tal:condition="faceted_cols/col_dreta/mostrar"
                 tal:attributes="class faceted_cols/col_dreta/width"
                 id="right-column"
                 tal:define="position string:right">

                <metal:position use-macro="here/@@faceted_macros/macros/position" />
            </div>
            <div tal:condition="faceted_cols/col_centre/mostrar"
                 tal:attributes="class faceted_cols/col_centre/width"
                 id="center-column">
                <div class="row-fluid">
                    <div class="span12" id="center-column-top"
                        tal:define="position string:center">
                        <metal:position use-macro="here/@@faceted_macros/macros/position" />
                    </div>
                </div>

                <div class="row-fluid">
                    <div class="span12" id="center-column-middle">
                        <metal:results use-macro="here/@@faceted_macros/macros/results" />
                    </div>
                </div>

                <div class="row-fluid">
                    <div class="span12" id="center-column-bottom"
                        tal:define="position string:bottomcenter">
                        <metal:position use-macro="here/@@faceted_macros/macros/position" />
                    </div>
                </div>

            </div>
        </div>

        <div class="row-fluid">
            <div class="span12" id="bottom-area"
                tal:define="position string:bottom">
                <metal:position use-macro="here/@@faceted_macros/macros/position" />
            </div>
        </div>

        <div class="row-fluid faceted-sharing">
            <div class="span12">
                <div class="addthis_toolbox addthis_toolbox_faceted addthis_default_style addthis_32x32_style"
                     tal:attributes="addthis:url context/absolute_url;
                                     addthis:title context/Title;
                                     addthis:description context/Description;"> 
                    <a class="addthis_button_facebook"></a>
                    <a class="addthis_button_twitter"></a>
                    <a class="addthis_button_google_plusone_share"></a>
                </div>
                <div class="frase" i18n:domain="apuntador.theme" i18n:translate="">Comparteix la teva selecci√≥ d'esdeveniments amb els teus amics a les xarxes socials</div>
            </div>
        </div>

    </section>

</metal:widgets>
